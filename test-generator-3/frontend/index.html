<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <title>AI Test Generator - Professional Assessment Platform</title>
    <style>

    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="#" class="logo">
                <span>‚ú®</span>
                AI Test Generator
            </a>
            <ul class="nav-links">
                <li><a href="#generator">Generator</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="signup.html" class="btn btn-secondary btn-sm">Sign Up</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero fade-in">
        <h1>Generate Professional Tests with AI</h1>
        <p class="hero-subtitle">Create comprehensive, subject-specific assessments in seconds. Powered by advanced AI technology.</p>
        <div class="hero-buttons">
            <button class="btn btn-primary btn-lg" onclick="scrollToGenerator()">
                Get Started
            </button> 
        </div>
    </section>

     <!-- Generator Section -->
    <section id="generator" class="container" style="margin-top: var(--spacing-2xl);">
        <div class="generator-section">
            <h2>üöÄ Test Generator</h2>
            <p>Customize your test parameters below and generate your personalized assessment.</p>
        </div>

        <div style="background: var(--card-bg); padding: var(--spacing-xl); border-radius: 12px; margin-top: var(--spacing-lg);">
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab(event, 'form-tab')">Configure Test</button>
                <button class="tab-btn" onclick="switchTab(event, 'preview-tab')">Preview Questions</button>
            </div>

            <!-- Configure Test Tab -->
            <div id="form-tab" class="tab-content active">
                <form id="testForm">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                        <div class="form-group">
                            <label class="form-label">Test Title</label>
                            <input type="text" class="form-input" id="testTitle" placeholder="eg., Mid-Term Exam" required>
                        </div>

                        <!--<div class="form-group">
                            <label class="form-label">Subject</label>
                            <select class="form-select" id="subject" required>
                                <option value="">Select Subject</option>
                                <option value="physics">Physics</option>
                                <option value="chemistry">Chemistry</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="biology">Biology</option>
                                <option value="history">History</option>
                                <option value="english">English</option>
                                <option value="geography">Geography</option>
                            </select>
                        </div>-->

                        <div class="form-group">
                            <label class="form-label">Difficulty Level</label>
                            <select class="form-select" id="difficulty" required>
                                <option value="">Select Level</option>
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Number of Questions</label>
                            <input type="number" class="form-input" id="numQuestions" min="8" max="50" value="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Topics to Cover</label>
                        <textarea class="form-textarea" id="topics" placeholder="eg., Type Something...!" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Question Types</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                <input type="checkbox" id="mcq" checked> Multiple Choice
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                <input type="checkbox" id="shortAnswer"> Short Answer
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                <input type="checkbox" id="truefalse"> True/False
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                <input type="checkbox" id="essay"> Long Answer
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: var(--spacing-lg); margin-top: var(--spacing-xl);">
                        <button id="generateBtn" class="btn btn-primary btn-lg" onclick="generateTest()" style="flex: 1;" disabled>
                            Generate Test
                        </button>
                        <button type="button" class="btn btn-secondary btn-lg" onclick="resetForm()">
                            Reset
                        </button>
                    </div>

                    <div class="success-message" id="successMsg">
                        ‚úì Test generated successfully! Preview below.
                    </div>
                </form>
            </div>

            <!-- Preview Tab -->
            <div id="preview-tab" class="tab-content">
                <div class="test-preview hidden" id="testPreview">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                        <h3 id="previewTitle">
                            <span>üìã</span>
                            <span id="previewTestTitle">Test Preview</span>
                        </h3>
                        <div>
                            <span class="badge" id="previewDifficulty"></span>
                            <span class="badge badge-success" style="margin-left: var(--spacing-sm);" id="previewCount"></span>
                        </div>
                    </div>

                    <div style="background: var(--light-bg); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg);">
                        <p style="margin-top: var(--spacing-sm);"><strong>Topics:</strong> <span id="previewTopics"></span></p>
                    </div>

                    <div id="questionsContainer"></div>

                    <div style="display: flex; gap: var(--spacing-lg); margin-top: var(--spacing-xl);">
                        <button class="btn btn-primary" onclick="downloadTest()">
                            üì• Download PDF
                        </button>
                        <button class="btn btn-secondary" onclick="shareTest()">
                            üì§ Share Test
                        </button>
                        <button class="btn btn-secondary" onclick="printTest()">
                            üñ® Print
                        </button>
                    </div>
                </div>

                <div style="text-align: center; padding: var(--spacing-2xl); color: var(--text-secondary);" id="emptyPreview">
                    <p style="font-size: 3rem; margin-bottom: var(--spacing-lg);">üìù</p>
                    <p>Generate a test first to preview questions here.</p>
                </div>
            </div>
        </div>
    </section>

    <footer id="about">
        <h3>About AI Test Generator</h3>
        <p style="margin: var(--spacing-lg) 0; max-width: 600px; margin-left: auto; margin-right: auto;">
            AI Test Generator is an intelligent assessment platform designed to help educators and students create comprehensive, high-quality tests in minutes. Our advanced algorithms ensure fair, relevant, and challenging questions tailored to your needs.
        </p>
        <p style="margin-top: var(--spacing-2xl); border-top: 1px solid var(--border); padding-top: var(--spacing-lg);">
            ¬© 2025 AI Test Generator. All rights reserved. | <a href="#" style="color: var(--primary);">Privacy</a> | <a href="#" style="color: var(--primary);">Terms</a>
        </p>
    </footer>

    <script>
        // Enable button only if user is logged in
        window.onload = function () {
            const btn = document.getElementById("generateBtn");
            const token = localStorage.getItem("token");

            if (token) {
                btn.disabled = false;   // enable button after login
            } else {
            btn.disabled = true;    // keep disabled until user logs in
            }
        };

        /* function openLogin() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLogin() {
            document.getElementById('loginModal').style.display = 'none';
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const res = await fetch('http://localhost:5000/api/auth/login', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const data = await res.json();
            console.log("LOGIN RESPONSE:", data);

            if (res.ok && data.token) {
                localStorage.setItem("token", data.token);
                alert("Login successful!");
                closeLogin();
            } else {
                alert(data.error || "Login failed");
            }
        }*/


        async function generateTest() {
            const token = localStorage.getItem("token");

            if (!token) {
                alert("‚ùó You must log in first. Backend requires authentication.");
                return;
            }

            const numQuestionsValue = parseInt(document.getElementById('numQuestions').value);
        const topicsValue = document.getElementById('topics').value;

        if (numQuestionsValue < 1 || topicsValue.trim() === "") {
            alert("Please provide a topic and a valid number of questions (minimum 1).");
            return;
        }
        
        document.getElementById('generateBtn').textContent = 'Generating...';
        document.getElementById('generateBtn').disabled = true;

            const testData = {
                title: document.getElementById('testTitle').value,
                notes: "Auto-generated test via frontend",   // required by backend
                count: parseInt(document.getElementById('numQuestions').value), 
                difficulty: document.getElementById('difficulty').value,
                topic: document.getElementById('topics').value,
                description: "Generated using AI Test Generator", // backend requires description
                timeLimitMin: 0
            };

            try {
                const response = await fetch("http://localhost:5000/api/tests/generate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + token
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                console.log("Backend Response:", result);

                if (!response.ok) {
                    alert(result.error || "Test generation failed.");
                    return;
                }

                document.getElementById('form-tab').classList.remove('active');
                document.getElementById('preview-tab').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.remove('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
            
                document.getElementById('successMsg').style.display = 'block';

                renderTestPreview(
                    testData.title,
                    "N/A",
                    testData.difficulty,
                    testData.count,
                    testData.topic,
                    result.questions
                );

            } catch (error) {
                console.error("Error connecting to backend:", error);
                alert("Could not reach backend.");
            }finally {
            document.getElementById('generateBtn').textContent = 'Generate Test';
            document.getElementById('generateBtn').disabled = false;
            }
        }

        function renderTestPreview(testTitle, subject, difficulty, numQuestions, topicsText,questionsArray) {
            const preview = document.getElementById('testPreview');
            const empty = document.getElementById('emptyPreview');
            const container = document.getElementById('questionsContainer');

            // Update metadata
            document.getElementById('previewTestTitle').textContent = testTitle;
            document.getElementById('previewTopics').textContent = topicsText;
            document.getElementById('previewDifficulty').textContent = difficulty.toUpperCase();
            document.getElementById('previewCount').textContent = questionsArray.length + ' Questions';

            // Generate questions
            container.innerHTML = '';
            for (let i = 0; i < questionsArray.length; i++) {
                const q = questionsArray[i];
                const questionEl = document.createElement('div');
                questionEl.className = 'test-question';
                
                questionEl.innerHTML = `
                    <div class="test-question-title">Q${i + 1}. ${q.question}</div>
                    ${renderQuestionOptions(q)}
                `;
                container.appendChild(questionEl);
            }

            preview.classList.remove('hidden');
            empty.classList.add('hidden');
        }

        function renderQuestionOptions(q) {
            if (q.type === 'MCQ') {
                return `
                    <div class="test-options">
                        ${q.options.map((opt, idx) => `
                            <label class="test-option">
                                <input type="radio" name="q${idx}" value="${opt}">
                                <span>${String.fromCharCode(65 + idx)}. ${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
            } else if (q.type === 'True/False') {
                return `
                    <div class="test-options">
                        <label class="test-option">
                            <input type="radio" name="q" value="true">
                            <span>A. True</span>
                        </label>
                        <label class="test-option">
                            <input type="radio" name="q" value="false">
                            <span>B. False</span>
                        </label>
                    </div>
                `;
            } else {
                return `<div style="margin-top: var(--spacing-md); padding: var(--spacing-md); border: 1px dashed var(--border); border-radius: 6px; min-height: 60px; background: white;">Answer: _________________</div>`;
            }
        }

        function resetForm() {
            document.getElementById('testForm').reset();
            document.getElementById('testPreview').classList.add('hidden');
            document.getElementById('emptyPreview').classList.remove('hidden');
        }

        function downloadTest() {
            alert('Download feature will be available soon. This would generate a PDF version of the test.');
        }

        function shareTest() {
            alert('Share feature will be available soon. You can share this test via link or email.');
        }

        function printTest() {
            window.print();
        }

        function switchTab(event, tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remove active from all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function scrollToGenerator() {
            document.getElementById('generator').scrollIntoView({ behavior: 'smooth' });
        }

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                generateTest();
            }
        });



        // Lock generator until user logs in
   document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("token");

            if (!token) {
                document.getElementById("generator").style.pointerEvents = "none";
                document.getElementById("generator").style.opacity = "0.4";
            } else {
                document.getElementById("generator").style.pointerEvents = "auto";
                document.getElementById("generator").style.opacity = "1";
            }
        });


    </script>
</body>
</html>